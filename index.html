<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PNG Upload & Download with Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6 font-sans">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Upload PNG to Firebase</h1>

    <!-- Upload Section -->
    <div class="bg-white rounded-xl shadow p-6 mb-10 text-center">
      <input type="file" id="uploadInput" multiple accept="image/png" class="mb-4 mx-auto" />
      <p class="text-sm text-gray-500">Only PNG files are allowed. Upload multiple files at once.</p>
    </div>

    <!-- Image Preview Section -->
    <div id="imageContainer" class="grid grid-cols-2 md:grid-cols-3 gap-6"></div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import {
      getStorage,
      ref as storageRef,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    // আপনার Firebase config (firebaseConfig) এখান থেকে কপি করে ব্যবহার করুন
    const firebaseConfig = {
      apiKey: "AIzaSyB7HJI-1y7sp__gSqGU9F38lsooaCEXpFc",
      authDomain: "pngfiledownload.firebaseapp.com",
      projectId: "pngfiledownload",
      storageBucket: "pngfiledownload.firebasestorage.app",
      messagingSenderId: "9458347777",
      appId: "1:9458347777:web:62017497ec436c34f83500",
      measurementId: "G-GJPBFNLBRB"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const storage = getStorage(app);

    const uploadInput = document.getElementById("uploadInput");
    const imageContainer = document.getElementById("imageContainer");

    // ফাইল আপলোড হ্যান্ডলার
    uploadInput.addEventListener("change", async (e) => {
      const files = Array.from(e.target.files);

      for (const file of files) {
        if (file.type !== "image/png") {
          alert(`File "${file.name}" is not a PNG file.`);
          continue;
        }

        // Firebase Storage রেফারেন্স (unique নামের জন্য timestamp যুক্ত করা হলো)
        const fileRef = storageRef(storage, "pngs/" + Date.now() + "_" + file.name);

        try {
          // আপলোড
          await uploadBytes(fileRef, file);

          // ডাউনলোড URL নেয়া
          const downloadURL = await getDownloadURL(fileRef);

          // UI এ নতুন ছবি ও ডাউনলোড বাটন যোগ
          const html = `
            <div class="bg-white rounded shadow p-4 text-center">
              <img src="${downloadURL}" alt="${file.name}" class="h-40 object-contain mx-auto mb-2" />
              <p class="text-sm text-gray-700 truncate">${file.name}</p>
              <a href="${downloadURL}" download class="inline-block mt-2 px-4 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">Download</a>
            </div>
          `;

          imageContainer.insertAdjacentHTML("beforeend", html);
        } catch (err) {
          alert(`Failed to upload ${file.name}: ${err.message}`);
        }
      }

      // ইনপুট রিসেট
      uploadInput.value = "";
    });
  </script>
</body>
</html>
